<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NanaBoison Utilities</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/gwDSdNBh/icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(252, 161, 125, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(139, 92, 246, 0.3) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
            pointer-events: none;
        }
        
        @keyframes gradientShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        
        .tab-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .tab-button:hover::before {
            left: 100%;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px -5px rgba(102, 126, 234, 0.5);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .btn-success:hover {
            box-shadow: 0 15px 35px -5px rgba(17, 153, 142, 0.5);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #434343 0%, #000000 100%);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.5);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #4a5568;
        }
        
        .btn-purple:hover {
            box-shadow: 0 15px 35px -5px rgba(168, 237, 234, 0.5);
        }
        
        textarea, input[type="text"] {
            transition: all 0.3s ease;
        }
        
        textarea:focus, input[type="text"]:focus {
            transform: scale(1.01);
            box-shadow: 0 10px 30px -5px rgba(102, 126, 234, 0.2);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .file-input {
            position: relative;
            overflow: hidden;
            display: inline-block;
            cursor: pointer;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 1rem 2rem;
            border-radius: 9999px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .file-input:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px -5px rgba(245, 87, 108, 0.5);
        }
        
        .file-input input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            padding: 0;
            font-size: 20px;
            cursor: pointer;
            opacity: 0;
            filter: alpha(opacity=0);
        }
        
        #markdownPreview {
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        }
        
        #markdownPreview h1 { 
            font-size: 2em; 
            font-weight: 800; 
            margin-bottom: 0.5em; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            border-bottom: 2px solid #e5e7eb;
        }
        
        #markdownPreview h2 { 
            font-size: 1.5em; 
            font-weight: 700; 
            margin-bottom: 0.5em; 
            color: #667eea;
            border-bottom: 1px solid #e5e7eb; 
        }
        
        .message-box {
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .icon-animate {
            display: inline-block;
            transition: transform 0.3s ease;
        }
        
        button:hover .icon-animate {
            transform: scale(1.2) rotate(5deg);
        }
        
        .qr-container {
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        }
    </style>
</head>
<body class="flex items-center justify-center p-4 min-h-screen">
    <div class="glass-card p-8 rounded-3xl w-full max-w-6xl text-center fade-in" style="animation-delay: 0.1s;">
        
        <!-- Header -->
        <div class="mb-10">
            <h1 class="text-5xl font-extrabold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600">
                NanaBoison Utilities
            </h1>
            <p class="text-gray-600 text-sm">Powerful tools for developers and creators</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex justify-center mb-8 bg-white bg-opacity-50 rounded-2xl p-2 shadow-inner flex-wrap gap-2">
            <button id="tabCsvToJson" class="tab-button active py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fas fa-file-csv icon-animate mr-2"></i>CSV to JSON
            </button>
            <button id="tabJsonToCsv" class="tab-button py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fas fa-table icon-animate mr-2"></i>JSON to CSV
            </button>
            <button id="tabJsonBeautifier" class="tab-button py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fas fa-code icon-animate mr-2"></i>JSON Lint
            </button>
            <button id="tabJsonStringify" class="tab-button py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fas fa-quote-right icon-animate mr-2"></i>Stringify
            </button>
            <button id="tabTextDelimiter" class="tab-button py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fas fa-exchange-alt icon-animate mr-2"></i>Delimiter
            </button>
            <button id="tabQrCodeGenerator" class="tab-button py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fas fa-qrcode icon-animate mr-2"></i>QR Code
            </button>
            <button id="tabMarkdownViewer" class="tab-button py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fab fa-markdown icon-animate mr-2"></i>Markdown
            </button>
            <button id="tabEpubToPdf" class="tab-button py-3 px-6 rounded-xl font-semibold text-sm">
                <i class="fas fa-file-pdf icon-animate mr-2"></i>EPUB to PDF
            </button>
        </div>

        <!-- Message Box -->
        <div id="messageBox" class="message-box mb-6 p-4 text-sm rounded-xl hidden text-left shadow-lg" role="alert"></div>

        <!-- CSV to JSON Section -->
        <div id="csvToJsonSection" class="converter-section fade-in">
            <p class="text-gray-600 mb-8 text-lg">Transform your CSV files into structured JSON format</p>
            <label class="file-input mb-6 block w-full md:w-auto inline-block">
                <i class="fas fa-upload mr-2"></i>Choose CSV File
                <input type="file" id="csvFileInput" accept=".csv" />
            </label>
            <button id="convertCsvToJsonButton" class="btn-primary w-full text-white font-bold py-4 px-8 rounded-2xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed mb-6" disabled>
                <i class="fas fa-sync-alt icon-animate mr-2"></i>Convert to JSON
            </button>

            <div id="jsonOutputContainer" class="hidden mt-8 text-left fade-in">
                <label for="jsonOutput" class="block text-gray-800 text-sm font-bold mb-3">Generated JSON:</label>
                <textarea id="jsonOutput" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-white text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[300px]" readonly></textarea>
                <button id="downloadJsonButton" class="btn-success mt-6 text-white font-bold py-3 px-6 rounded-2xl shadow-md">
                    <i class="fas fa-download icon-animate mr-2"></i>Download JSON
                </button>
            </div>
        </div>

        <!-- JSON to CSV Section -->
        <div id="jsonToCsvSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8 text-lg">Convert your JSON data into spreadsheet-ready CSV</p>
            <label class="file-input mb-6 block w-full md:w-auto inline-block">
                <i class="fas fa-upload mr-2"></i>Choose JSON File
                <input type="file" id="jsonFileInput" accept=".json" />
            </label>
            <button id="convertJsonToCsvButton" class="btn-primary w-full text-white font-bold py-4 px-8 rounded-2xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <i class="fas fa-sync-alt icon-animate mr-2"></i>Convert to CSV
            </button>
        </div>

        <!-- JSON Beautifier Section -->
        <div id="jsonBeautifierSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8 text-lg">Lint and beautify your JSON with perfect formatting</p>
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <button id="beautifyJsonButton" class="btn-primary flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg">
                    <i class="fas fa-magic icon-animate mr-2"></i>Lint & Beautify
                </button>
                <button id="downloadBeautifiedJsonButton" class="btn-success flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hidden">
                    <i class="fas fa-download icon-animate mr-2"></i>Download
                </button>
                <button id="copyBeautifiedJsonButton" class="btn-secondary flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hidden">
                    <i class="fas fa-copy icon-animate mr-2"></i>Copy
                </button>
            </div>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="flex-1">
                    <label for="jsonInputToBeautify" class="block text-gray-800 text-sm font-bold mb-3 text-left">Input JSON:</label>
                    <textarea id="jsonInputToBeautify" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-white text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[350px]" placeholder='{"name":"John","age":30}'></textarea>
                </div>
                <div class="flex-1">
                    <label for="beautifiedJsonOutput" class="block text-gray-800 text-sm font-bold mb-3 text-left">Beautified JSON:</label>
                    <textarea id="beautifiedJsonOutput" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-gradient-to-br from-gray-50 to-gray-100 text-gray-800 font-mono text-xs focus:outline-none min-h-[350px]" readonly></textarea>
                </div>
            </div>
        </div>

        <!-- JSON Stringify Section -->
        <div id="jsonStringifySection" class="converter-section hidden">
            <p class="text-gray-600 mb-8 text-lg">Convert between JSON and escaped string literals</p>
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <button id="jsonToStringButton" class="btn-primary flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg">
                    <i class="fas fa-arrow-right icon-animate mr-2"></i>JSON to String
                </button>
                <button id="stringToJsonButton" class="btn-purple flex-1 font-bold py-4 px-6 rounded-2xl shadow-lg">
                    <i class="fas fa-arrow-left icon-animate mr-2"></i>String to JSON
                </button>
                <button id="copyStringifyResultButton" class="btn-secondary flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hidden">
                    <i class="fas fa-copy icon-animate mr-2"></i>Copy
                </button>
            </div>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="flex-1">
                    <label for="stringifyInput" class="block text-gray-800 text-sm font-bold mb-3 text-left">Input:</label>
                    <textarea id="stringifyInput" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-white text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[350px]" placeholder='Paste JSON or string here...'></textarea>
                </div>
                <div class="flex-1">
                    <label for="stringifyOutput" class="block text-gray-800 text-sm font-bold mb-3 text-left">Output:</label>
                    <textarea id="stringifyOutput" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-gradient-to-br from-gray-50 to-gray-100 text-gray-800 font-mono text-xs focus:outline-none min-h-[350px]" readonly></textarea>
                </div>
            </div>
        </div>

        <!-- Text Delimiter Section -->
        <div id="textDelimiterSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8 text-lg">Replace delimiters in your text instantly</p>
            <div class="flex flex-col md:flex-row gap-6 mb-6">
                <div class="flex-1">
                    <label for="textInputToReplace" class="block text-gray-800 text-sm font-bold mb-3 text-left">Input Text:</label>
                    <textarea id="textInputToReplace" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-white text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[350px]" placeholder='apple|banana|cherry'></textarea>
                </div>
                <div class="flex-1">
                    <label for="replacedTextOutput" class="block text-gray-800 text-sm font-bold mb-3 text-left">Output Text:</label>
                    <textarea id="replacedTextOutput" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-gradient-to-br from-gray-50 to-gray-100 text-gray-800 font-mono text-xs focus:outline-none min-h-[350px]" readonly></textarea>
                </div>
            </div>
            <div class="flex flex-col md:flex-row gap-4 items-end mb-6">
                <div class="flex-1 text-left">
                    <label for="oldDelimiterInput" class="block text-gray-800 text-sm font-bold mb-3">Old Delimiter:</label>
                    <input type="text" id="oldDelimiterInput" class="w-full p-4 border-2 border-purple-200 rounded-xl bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="|" />
                </div>
                <div class="flex-1 text-left">
                    <label for="newDelimiterInput" class="block text-gray-800 text-sm font-bold mb-3">New Delimiter:</label>
                    <input type="text" id="newDelimiterInput" class="w-full p-4 border-2 border-purple-200 rounded-xl bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="," />
                </div>
                <button id="replaceDelimiterButton" class="btn-primary flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg">
                    <i class="fas fa-sync icon-animate mr-2"></i>Replace
                </button>
            </div>
            <div class="flex gap-4">
                <button id="downloadReplacedTextButton" class="btn-success flex-1 text-white font-bold py-3 px-6 rounded-2xl shadow-lg hidden">
                    <i class="fas fa-download icon-animate mr-2"></i>Download
                </button>
                <button id="copyReplacedTextButton" class="btn-secondary flex-1 text-white font-bold py-3 px-6 rounded-2xl shadow-lg hidden">
                    <i class="fas fa-copy icon-animate mr-2"></i>Copy
                </button>
            </div>
        </div>
        
        <!-- QR Code Generator Section -->
        <div id="qrCodeGeneratorSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8 text-lg">Generate beautiful QR codes for any text or URL</p>
            <div class="flex flex-col md:flex-row gap-6 items-start">
                <div class="flex-1">
                    <label for="qrCodeInput" class="block text-gray-800 text-sm font-bold mb-3 text-left">Text or URL:</label>
                    <textarea id="qrCodeInput" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-white text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[250px]" placeholder='https://www.example.com'></textarea>
                    <button id="generateQrCodeButton" class="btn-primary w-full mt-6 text-white font-bold py-4 px-6 rounded-2xl shadow-lg">
                        <i class="fas fa-qrcode icon-animate mr-2"></i>Generate QR Code
                    </button>
                </div>
                <div class="flex-1">
                    <label class="block text-gray-800 text-sm font-bold mb-3 text-left">QR Code Preview:</label>
                    <div id="qrCodeOutputContainer" class="qr-container p-8 rounded-2xl flex flex-col items-center justify-center min-h-[250px] space-y-4 border-2 border-purple-200">
                        <canvas id="qrCodeCanvas" class="hidden rounded-xl shadow-xl"></canvas>
                        <p id="qrCodePlaceholder" class="text-gray-500">Your QR code will appear here</p>
                        <button id="downloadQrCodeButton" class="btn-success text-white font-bold py-3 px-6 rounded-2xl shadow-lg hidden mt-4">
                            <i class="fas fa-download icon-animate mr-2"></i>Download QR Code
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Markdown Viewer Section -->
        <div id="markdownViewerSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8 text-lg">Write Markdown and see live HTML preview</p>
            <div class="flex gap-4 mb-6">
                <button id="copyMarkdownHtmlButton" class="btn-secondary flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg">
                    <i class="fas fa-copy icon-animate mr-2"></i>Copy HTML
                </button>
                <button id="downloadMarkdownHtmlButton" class="btn-success flex-1 text-white font-bold py-4 px-6 rounded-2xl shadow-lg">
                    <i class="fas fa-download icon-animate mr-2"></i>Download HTML
                </button>
            </div>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="flex-1">
                    <label for="markdownInput" class="block text-gray-800 text-sm font-bold mb-3 text-left">Markdown Editor:</label>
                    <textarea id="markdownInput" class="w-full p-4 border-2 border-purple-200 rounded-2xl bg-white text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[450px]" placeholder="# Hello Markdown&#10;&#10;Write your content here..."></textarea>
                </div>
                <div class="flex-1">
                    <label class="block text-gray-800 text-sm font-bold mb-3 text-left">Live Preview:</label>
                    <div id="markdownPreview" class="text-left p-6 border-2 border-purple-200 rounded-2xl min-h-[450px] overflow-y-auto"></div>
                </div>
            </div>
        </div>

        <!-- EPUB to PDF Section -->
        <div id="epubToPdfSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8 text-lg">Convert your EPUB ebooks to PDF format</p>
            
            <!-- Server Status Indicator -->
            <div id="serverStatusIndicator" class="mb-6 p-4 rounded-xl border-2 hidden">
                <div class="flex items-center justify-center space-x-3">
                    <div id="serverStatusIcon" class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full"></div>
                        <span id="serverStatusText" class="text-sm font-semibold"></span>
                    </div>
                </div>
            </div>
            
            <div class="max-w-2xl mx-auto">
                <label class="file-input mb-6 block w-full md:w-auto inline-block">
                    <i class="fas fa-upload mr-2"></i>Choose EPUB File
                    <input type="file" id="epubFileInput" accept=".epub" />
                </label>
                <button id="convertEpubToPdfButton" class="btn-primary w-full text-white font-bold py-4 px-8 rounded-2xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed mb-6" disabled>
                    <i class="fas fa-sync-alt icon-animate mr-2"></i>Convert to PDF
                </button>
                
                <div id="epubConversionProgress" class="hidden mb-6">
                    <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div id="epubProgressBar" class="h-full bg-gradient-to-r from-purple-600 to-pink-600 transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p id="epubProgressText" class="text-center mt-2 text-sm text-gray-600">Processing...</p>
                </div>

                <div id="epubOutputContainer" class="hidden mt-8 text-left fade-in">
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-2xl border-2 border-purple-200">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-gray-800 font-bold text-lg">âœ“ Conversion Complete!</p>
                                <p id="epubFileName" class="text-gray-600 text-sm mt-1"></p>
                            </div>
                            <i class="fas fa-file-pdf text-5xl text-red-500"></i>
                        </div>
                        <button id="downloadPdfButton" class="btn-success w-full text-white font-bold py-3 px-6 rounded-2xl shadow-md">
                            <i class="fas fa-download icon-animate mr-2"></i>Download PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- Global DOM References ---
        const messageBox = document.getElementById('messageBox');
        const tabCsvToJson = document.getElementById('tabCsvToJson');
        const tabJsonToCsv = document.getElementById('tabJsonToCsv');
        const tabJsonBeautifier = document.getElementById('tabJsonBeautifier');
        const tabJsonStringify = document.getElementById('tabJsonStringify');
        const tabTextDelimiter = document.getElementById('tabTextDelimiter');
        const tabQrCodeGenerator = document.getElementById('tabQrCodeGenerator');
        const tabMarkdownViewer = document.getElementById('tabMarkdownViewer');
        const tabEpubToPdf = document.getElementById('tabEpubToPdf');

        const csvToJsonSection = document.getElementById('csvToJsonSection');
        const jsonToCsvSection = document.getElementById('jsonToCsvSection');
        const jsonBeautifierSection = document.getElementById('jsonBeautifierSection');
        const jsonStringifySection = document.getElementById('jsonStringifySection');
        const textDelimiterSection = document.getElementById('textDelimiterSection');
        const qrCodeGeneratorSection = document.getElementById('qrCodeGeneratorSection');
        const markdownViewerSection = document.getElementById('markdownViewerSection');
        const epubToPdfSection = document.getElementById('epubToPdfSection');

        const downloadBeautifiedJsonButton = document.getElementById('downloadBeautifiedJsonButton');
        const copyBeautifiedJsonButton = document.getElementById('copyBeautifiedJsonButton');
        
        const jsonToStringButton = document.getElementById('jsonToStringButton');
        const stringToJsonButton = document.getElementById('stringToJsonButton');
        const copyStringifyResultButton = document.getElementById('copyStringifyResultButton');
        const stringifyInput = document.getElementById('stringifyInput');
        const stringifyOutput = document.getElementById('stringifyOutput');

        const downloadReplacedTextButton = document.getElementById('downloadReplacedTextButton');
        const copyReplacedTextButton = document.getElementById('copyReplacedTextButton');
        const downloadQrCodeButton = document.getElementById('downloadQrCodeButton');
        const qrCodeCanvas = document.getElementById('qrCodeCanvas');
        const qrCodePlaceholder = document.getElementById('qrCodePlaceholder');
        const markdownPreview = document.getElementById('markdownPreview');

        // EPUB to PDF API endpoint - REPLACE THIS WITH YOUR RENDER.COM URL AFTER DEPLOYMENT
        const EPUB_API_URL = 'https://nb-utils.onrender.com/convert';
        const EPUB_HEALTH_URL = 'https://nb-utils.onrender.com/health';
        
        let currentPdfBlob = null;
        let serverStatus = 'unknown'; // 'healthy', 'waking', 'down', 'unknown'

        // Wake up the server on page load
        async function wakeUpServer() {
            try {
                console.log('Checking server health...');
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                
                const response = await fetch(EPUB_HEALTH_URL, {
                    method: 'GET',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    const data = await response.json();
                    serverStatus = 'healthy';
                    console.log('Server is healthy:', data);
                    return true;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('Server is waking up (timeout after 10s)...');
                    serverStatus = 'waking';
                } else {
                    console.log('Server health check failed:', error.message);
                    serverStatus = 'down';
                }
                return false;
            }
        }

        // Call wake up on page load
        if (EPUB_API_URL !== 'https://nb-utils.onrender.com/convert') {
            wakeUpServer();
        }

        // --- Utility Functions ---

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight + 2) + 'px';
        }

        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');
            if (type === 'success') messageBox.classList.add('bg-green-100', 'text-green-800');
            else if (type === 'error') messageBox.classList.add('bg-red-100', 'text-red-800');
            else messageBox.classList.add('bg-blue-100', 'text-blue-800');
            messageBox.classList.remove('hidden');
        }

        function hideMessageBox() {
            messageBox.classList.add('hidden');
        }

        function downloadText(textContent, filename, mimeType = 'text/plain') {
            const blob = new Blob([textContent], { type: `${mimeType};charset=utf-8;` });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } else {
                showMessage('Your browser does not support downloads.', 'info');
            }
        }

        function copyToClipboard(text, successMsg) {
            const temp = document.createElement('textarea');
            temp.value = text;
            document.body.appendChild(temp);
            temp.select();
            try {
                document.execCommand('copy');
                showMessage(successMsg, 'success');
            } catch (err) {
                showMessage('Failed to copy.', 'error');
            }
            document.body.removeChild(temp);
        }

        function switchTab(activeTabButton, activeSection) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            activeTabButton.classList.add('active');
            document.querySelectorAll('.converter-section').forEach(section => section.classList.add('hidden'));
            activeSection.classList.remove('hidden');
            hideMessageBox();

            // Resets
            document.getElementById('csvFileInput').value = '';
            document.getElementById('convertCsvToJsonButton').disabled = true;
            document.getElementById('jsonOutputContainer').classList.add('hidden');
            document.getElementById('jsonOutput').value = '';
            document.getElementById('jsonFileInput').value = '';
            document.getElementById('convertJsonToCsvButton').disabled = true;
            
            document.getElementById('jsonInputToBeautify').value = '';
            document.getElementById('beautifiedJsonOutput').value = '';
            document.getElementById('beautifiedJsonOutput').style.height = '350px';
            downloadBeautifiedJsonButton.classList.add('hidden');
            copyBeautifiedJsonButton.classList.add('hidden');

            stringifyInput.value = '';
            stringifyOutput.value = '';
            stringifyOutput.style.height = '350px';
            copyStringifyResultButton.classList.add('hidden');
            
            document.getElementById('textInputToReplace').value = '';
            document.getElementById('oldDelimiterInput').value = '';
            document.getElementById('newDelimiterInput').value = '';
            document.getElementById('replacedTextOutput').value = '';
            document.getElementById('replacedTextOutput').style.height = '350px';
            downloadReplacedTextButton.classList.add('hidden');
            copyReplacedTextButton.classList.add('hidden');
            
            document.getElementById('qrCodeInput').value = '';
            qrCodeCanvas.classList.add('hidden');
            qrCodePlaceholder.classList.remove('hidden');
            downloadQrCodeButton.classList.add('hidden');
            
            document.getElementById('markdownInput').value = '';
            markdownPreview.innerHTML = '';
            
            document.getElementById('epubFileInput').value = '';
            document.getElementById('convertEpubToPdfButton').disabled = true;
            document.getElementById('epubConversionProgress').classList.add('hidden');
            document.getElementById('epubOutputContainer').classList.add('hidden');
            document.getElementById('epubProgressBar').style.width = '0%';
            currentPdfBlob = null;
            updateServerStatus();
        }

        // Update server status indicator
        function updateServerStatus() {
            const indicator = document.getElementById('serverStatusIndicator');
            const icon = document.getElementById('serverStatusIcon').querySelector('div');
            const text = document.getElementById('serverStatusText');
            
            // Only show in EPUB to PDF section
            const isEpubSection = !document.getElementById('epubToPdfSection').classList.contains('hidden');
            
            if (!isEpubSection || EPUB_API_URL === 'https://nb-utils.onrender.com/convert') {
                indicator.classList.add('hidden');
                return;
            }
            
            indicator.classList.remove('hidden');
            
            if (serverStatus === 'healthy') {
                indicator.className = 'mb-6 p-4 rounded-xl border-2 border-green-300 bg-green-50';
                icon.className = 'w-3 h-3 rounded-full bg-green-500 animate-pulse';
                text.textContent = 'Server Ready';
                text.className = 'text-sm font-semibold text-green-700';
            } else if (serverStatus === 'waking') {
                indicator.className = 'mb-6 p-4 rounded-xl border-2 border-yellow-300 bg-yellow-50';
                icon.className = 'w-3 h-3 rounded-full bg-yellow-500 animate-pulse';
                text.textContent = 'Server Waking Up... (may take 30-60 seconds)';
                text.className = 'text-sm font-semibold text-yellow-700';
            } else if (serverStatus === 'down') {
                indicator.className = 'mb-6 p-4 rounded-xl border-2 border-red-300 bg-red-50';
                icon.className = 'w-3 h-3 rounded-full bg-red-500';
                text.textContent = 'Server Unavailable - Check your API URL';
                text.className = 'text-sm font-semibold text-red-700';
            } else {
                indicator.className = 'mb-6 p-4 rounded-xl border-2 border-gray-300 bg-gray-50';
                icon.className = 'w-3 h-3 rounded-full bg-gray-400 animate-pulse';
                text.textContent = 'Checking Server Status...';
                text.className = 'text-sm font-semibold text-gray-700';
            }
        }

        // --- CSV to JSON ---
        document.getElementById('csvFileInput').addEventListener('change', () => {
            document.getElementById('convertCsvToJsonButton').disabled = document.getElementById('csvFileInput').files.length === 0;
            hideMessageBox();
            document.getElementById('jsonOutputContainer').classList.add('hidden');
        });

        document.getElementById('convertCsvToJsonButton').addEventListener('click', () => {
            const file = document.getElementById('csvFileInput').files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const res = convertCsvToJson(e.target.result);
                    document.getElementById('jsonOutput').value = JSON.stringify(res, null, 2);
                    document.getElementById('jsonOutputContainer').classList.remove('hidden');
                    showMessage('Converted successfully!', 'success');
                } catch (err) { showMessage(err.message, 'error'); }
            };
            reader.readAsText(file);
        });

        document.getElementById('downloadJsonButton').addEventListener('click', () => {
            downloadText(document.getElementById('jsonOutput').value, 'data.json', 'application/json');
        });

        function convertCsvToJson(csvString) {
            const lines = csvString.split(/\r?\n/).filter(line => line.trim() !== '');
            if (lines.length === 0) return [];
            const headers = parseCsvLine(lines[0]);
            const jsonArray = [];
            for (let i = 1; i < lines.length; i++) {
                const rowValues = parseCsvLine(lines[i]);
                const obj = {};
                headers.forEach((h, idx) => obj[h] = rowValues[idx] || '');
                jsonArray.push(obj);
            }
            return jsonArray;
        }

        function parseCsvLine(line) {
            const fields = [];
            let inQuote = false, cur = '';
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    if (inQuote && line[i+1] === '"') { cur += '"'; i++; }
                    else inQuote = !inQuote;
                } else if (char === ',' && !inQuote) { fields.push(cur.trim()); cur = ''; }
                else cur += char;
            }
            fields.push(cur.trim());
            return fields;
        }

        // --- JSON to CSV ---
        document.getElementById('jsonFileInput').addEventListener('change', () => {
            document.getElementById('convertJsonToCsvButton').disabled = document.getElementById('jsonFileInput').files.length === 0;
            hideMessageBox();
        });

        document.getElementById('convertJsonToCsvButton').addEventListener('click', () => {
            const file = document.getElementById('jsonFileInput').files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    const csv = convertJsonToCsv(data);
                    downloadText(csv, 'data.csv', 'text/csv');
                    showMessage('CSV Downloading...', 'success');
                } catch (err) { showMessage('Invalid JSON file', 'error'); }
            };
            reader.readAsText(file);
        });

        function convertJsonToCsv(jsonData) {
            if (!jsonData.length) return '';
            const keys = Array.from(new Set(jsonData.flatMap(Object.keys)));
            const rows = [keys.join(',')];
            jsonData.forEach(item => {
                rows.push(keys.map(k => {
                    let v = item[k] === null || item[k] === undefined ? '' : item[k];
                    if (typeof v === 'object') v = JSON.stringify(v);
                    v = String(v).replace(/"/g, '""');
                    return v.includes(',') || v.includes('"') || v.includes('\n') ? `"${v}"` : v;
                }).join(','));
            });
            return rows.join('\n');
        }

        // --- JSON Lint ---
        document.getElementById('beautifyJsonButton').addEventListener('click', () => {
            const val = document.getElementById('jsonInputToBeautify').value.trim();
            hideMessageBox();
            if (!val) { showMessage('Please paste JSON first', 'info'); return; }
            try {
                const parsed = JSON.parse(val);
                document.getElementById('beautifiedJsonOutput').value = JSON.stringify(parsed, null, 2);
                adjustTextareaHeight(document.getElementById('beautifiedJsonOutput'));
                downloadBeautifiedJsonButton.classList.remove('hidden');
                copyBeautifiedJsonButton.classList.remove('hidden');
                showMessage('JSON Beautified successfully!', 'success');
            } catch (err) { showMessage(err.message, 'error'); }
        });

        downloadBeautifiedJsonButton.addEventListener('click', () => downloadText(document.getElementById('beautifiedJsonOutput').value, 'pretty.json', 'application/json'));
        copyBeautifiedJsonButton.addEventListener('click', () => copyToClipboard(document.getElementById('beautifiedJsonOutput').value, 'JSON Copied to clipboard!'));

        // --- JSON Stringify (JSON <-> String) ---
        jsonToStringButton.addEventListener('click', () => {
            const val = stringifyInput.value.trim();
            hideMessageBox();
            if (!val) return showMessage('Please paste JSON first', 'info');
            try {
                const parsed = JSON.parse(val);
                stringifyOutput.value = JSON.stringify(JSON.stringify(parsed));
                adjustTextareaHeight(stringifyOutput);
                copyStringifyResultButton.classList.remove('hidden');
                showMessage('Converted to escaped string!', 'success');
            } catch (err) { showMessage('Invalid JSON Object', 'error'); }
        });

        stringToJsonButton.addEventListener('click', () => {
            const val = stringifyInput.value.trim();
            hideMessageBox();
            if (!val) return showMessage('Please paste escaped string first', 'info');
            try {
                let result = val;
                if ((val.startsWith('"') && val.endsWith('"')) || (val.startsWith("'") && val.endsWith("'"))) {
                   result = JSON.parse(val);
                }
                const parsedObj = JSON.parse(result);
                stringifyOutput.value = JSON.stringify(parsedObj, null, 2);
                adjustTextareaHeight(stringifyOutput);
                copyStringifyResultButton.classList.remove('hidden');
                showMessage('Parsed to JSON object!', 'success');
            } catch (err) { showMessage('Invalid escaped string or JSON', 'error'); }
        });

        copyStringifyResultButton.addEventListener('click', () => {
            copyToClipboard(stringifyOutput.value, 'Result Copied to clipboard!');
        });

        // --- Text Delimiter ---
        document.getElementById('replaceDelimiterButton').addEventListener('click', () => {
            const input = document.getElementById('textInputToReplace').value;
            const oldD = document.getElementById('oldDelimiterInput').value;
            const newD = document.getElementById('newDelimiterInput').value;
            hideMessageBox();
            if (!input) return showMessage('Please paste text', 'info');
            if (!oldD) return showMessage('Please enter old delimiter', 'error');
            const result = input.replaceAll(oldD, newD);
            document.getElementById('replacedTextOutput').value = result;
            adjustTextareaHeight(document.getElementById('replacedTextOutput'));
            downloadReplacedTextButton.classList.remove('hidden');
            copyReplacedTextButton.classList.remove('hidden');
            showMessage('Delimiter replaced successfully!', 'success');
        });

        downloadReplacedTextButton.addEventListener('click', () => downloadText(document.getElementById('replacedTextOutput').value, 'replaced.txt'));
        copyReplacedTextButton.addEventListener('click', () => copyToClipboard(document.getElementById('replacedTextOutput').value, 'Text Copied to clipboard!'));

        // --- QR Code ---
        let qr = new QRious({ element: qrCodeCanvas, size: 256 });
        document.getElementById('generateQrCodeButton').addEventListener('click', () => {
            const val = document.getElementById('qrCodeInput').value.trim();
            hideMessageBox();
            if (!val) return showMessage('Please enter text or link', 'error');
            qr.set({ value: val, foreground: '#667eea' });
            qrCodeCanvas.classList.remove('hidden');
            qrCodePlaceholder.classList.add('hidden');
            downloadQrCodeButton.classList.remove('hidden');
            showMessage('QR Code Generated successfully!', 'success');
        });

        downloadQrCodeButton.addEventListener('click', () => {
            const link = document.createElement('a');
            link.href = qrCodeCanvas.toDataURL("image/png");
            link.download = 'qrcode.png';
            link.click();
        });

        // --- Markdown Viewer ---
        document.getElementById('markdownInput').addEventListener('input', () => {
            markdownPreview.innerHTML = marked.parse(document.getElementById('markdownInput').value);
        });

        document.getElementById('copyMarkdownHtmlButton').addEventListener('click', () => {
            if (!markdownPreview.innerHTML) return showMessage('Please write markdown first', 'info');
            copyToClipboard(markdownPreview.innerHTML, 'HTML Copied to clipboard!');
        });

        document.getElementById('downloadMarkdownHtmlButton').addEventListener('click', () => {
            if (!markdownPreview.innerHTML) return showMessage('Please write markdown first', 'info');
            const fullHtml = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Rendered Markdown</title><style>body{font-family:sans-serif;padding:2em;}</style></head><body>${markdownPreview.innerHTML}</body></html>`;
            downloadText(fullHtml, 'rendered.html', 'text/html');
        });

        // --- Tab Listeners ---
        tabCsvToJson.addEventListener('click', () => switchTab(tabCsvToJson, csvToJsonSection));
        tabJsonToCsv.addEventListener('click', () => switchTab(tabJsonToCsv, jsonToCsvSection));
        tabJsonBeautifier.addEventListener('click', () => switchTab(tabJsonBeautifier, jsonBeautifierSection));
        tabJsonStringify.addEventListener('click', () => switchTab(tabJsonStringify, jsonStringifySection));
        tabTextDelimiter.addEventListener('click', () => switchTab(tabTextDelimiter, textDelimiterSection));
        tabQrCodeGenerator.addEventListener('click', () => switchTab(tabQrCodeGenerator, qrCodeGeneratorSection));
        tabMarkdownViewer.addEventListener('click', () => switchTab(tabMarkdownViewer, markdownViewerSection));
        tabEpubToPdf.addEventListener('click', () => switchTab(tabEpubToPdf, epubToPdfSection));

        // --- EPUB to PDF Converter ---
        document.getElementById('epubFileInput').addEventListener('change', () => {
            const hasFile = document.getElementById('epubFileInput').files.length > 0;
            document.getElementById('convertEpubToPdfButton').disabled = !hasFile;
            hideMessageBox();
            document.getElementById('epubOutputContainer').classList.add('hidden');
            document.getElementById('epubConversionProgress').classList.add('hidden');
        });

        document.getElementById('convertEpubToPdfButton').addEventListener('click', async () => {
            const fileInput = document.getElementById('epubFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('Please select an EPUB file', 'error');
                return;
            }

            // Check server status before conversion
            if (serverStatus === 'waking') {
                showMessage('Server is still waking up. Please wait 30-60 seconds and try again.', 'info');
                return;
            } else if (serverStatus === 'down') {
                showMessage('Server is unavailable. Please check your configuration.', 'error');
                return;
            }

            // Show progress
            document.getElementById('epubConversionProgress').classList.remove('hidden');
            document.getElementById('epubOutputContainer').classList.add('hidden');
            document.getElementById('convertEpubToPdfButton').disabled = true;
            hideMessageBox();

            // Animate progress bar
            const progressBar = document.getElementById('epubProgressBar');
            const progressText = document.getElementById('epubProgressText');
            progressBar.style.width = '30%';
            progressText.textContent = 'Uploading EPUB file...';

            try {
                const formData = new FormData();
                formData.append('file', file);

                progressBar.style.width = '50%';
                progressText.textContent = 'Converting to PDF... (this may take 1-3 minutes)';

                const response = await fetch(EPUB_API_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: response.statusText }));
                    throw new Error(errorData.error || `Conversion failed: ${response.statusText}`);
                }

                progressBar.style.width = '80%';
                progressText.textContent = 'Preparing download...';

                const blob = await response.blob();
                currentPdfBlob = blob;

                progressBar.style.width = '100%';
                progressText.textContent = 'Complete!';

                // Update server status to healthy after successful conversion
                serverStatus = 'healthy';
                updateServerStatus();

                // Show output container
                setTimeout(() => {
                    document.getElementById('epubConversionProgress').classList.add('hidden');
                    document.getElementById('epubOutputContainer').classList.remove('hidden');
                    document.getElementById('epubFileName').textContent = file.name.replace('.epub', '.pdf');
                    showMessage('EPUB converted successfully!', 'success');
                    document.getElementById('convertEpubToPdfButton').disabled = false;
                }, 500);

            } catch (error) {
                console.error('Conversion error:', error);
                document.getElementById('epubConversionProgress').classList.add('hidden');
                document.getElementById('convertEpubToPdfButton').disabled = false;
                
                let errorMessage = error.message;
                if (errorMessage.includes('Failed to fetch')) {
                    errorMessage = 'Cannot connect to server. The server may be sleeping - please wait 60 seconds and try again.';
                    serverStatus = 'waking';
                    updateServerStatus();
                    
                    // Try to wake up server
                    wakeUpServer().then(success => {
                        if (success) {
                            showMessage('Server is now ready! Please try converting again.', 'success');
                        }
                    });
                }
                
                showMessage(`Conversion failed: ${errorMessage}`, 'error');
            }
        });

        document.getElementById('downloadPdfButton').addEventListener('click', () => {
            if (!currentPdfBlob) {
                showMessage('No PDF available to download', 'error');
                return;
            }

            const url = URL.createObjectURL(currentPdfBlob);
            const link = document.createElement('a');
            link.href = url;
            const originalName = document.getElementById('epubFileInput').files[0].name;
            link.download = originalName.replace('.epub', '.pdf');
            link.click();
            URL.revokeObjectURL(url);
            showMessage('PDF downloaded successfully!', 'success');
        });

        document.addEventListener('DOMContentLoaded', () => {
            switchTab(tabCsvToJson, csvToJsonSection);
        });
    </script>
</body>
</html>

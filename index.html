<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NanaBoison Utilities</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://i.postimg.cc/gwDSdNBh/icon.png">
    
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- QRious library for client-side QR code generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <!-- Marked library for Markdown rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        /* Custom font for a clean look */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Custom styles for the textarea to ensure it's readable */
        textarea {
            resize: vertical; /* Allow vertical resizing for user */
            min-height: 150px; /* Minimum height for all textareas, except where specifically overridden */
            overflow: auto; /* Default to auto scroll if content exceeds size */
        }
        .tab-button.active {
            background-color: #3B82F6; /* blue-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        /* Markdown Preview Styling */
        #markdownPreview {
            text-align: left;
            padding: 1rem;
            background-color: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            min-height: 300px;
            overflow-y: auto;
        }
        #markdownPreview h1 { font-size: 2em; font-weight: bold; margin-bottom: 0.5em; border-bottom: 1px solid #eaecef; }
        #markdownPreview h2 { font-size: 1.5em; font-weight: bold; margin-bottom: 0.5em; border-bottom: 1px solid #eaecef; }
        #markdownPreview h3 { font-size: 1.25em; font-weight: bold; margin-bottom: 0.5em; }
        #markdownPreview p { margin-bottom: 1em; line-height: 1.6; }
        #markdownPreview ul { list-style-type: disc; padding-left: 2em; margin-bottom: 1em; }
        #markdownPreview ol { list-style-type: decimal; padding-left: 2em; margin-bottom: 1em; }
        #markdownPreview code { background-color: rgba(27,31,35,.05); padding: .2em .4em; border-radius: 3px; font-family: monospace; }
        #markdownPreview pre { background-color: #f6f8fa; padding: 1em; border-radius: 3px; overflow: auto; margin-bottom: 1em; }
        #markdownPreview blockquote { border-left: .25em solid #dfe2e5; color: #6a737d; padding: 0 1em; margin-bottom: 1em; }
        #markdownPreview a { color: #0366d6; text-decoration: none; }
        #markdownPreview a:hover { text-decoration: underline; }
        #markdownPreview table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
        #markdownPreview th, #markdownPreview td { border: 1px solid #dfe2e5; padding: 6px 13px; }
        #markdownPreview tr:nth-child(2n) { background-color: #f6f8fa; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-200 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full md:w-4/5 lg:w-3/4 text-center border border-gray-200">
        
        <!-- Header -->
        <h1 class="text-3xl font-extrabold text-gray-800 mb-8">NanaBoison Utilities</h1>

        <!-- Navigation Tabs -->
        <div class="flex justify-center mb-8 bg-gray-100 rounded-full p-1 shadow-inner flex-wrap">
            <button id="tabCsvToJson" class="tab-button active py-2 px-4 rounded-full text-gray-700 font-semibold transition-all duration-200 hover:bg-blue-500 hover:text-white">
                CSV to JSON
            </button>
            <button id="tabJsonToCsv" class="tab-button py-2 px-4 rounded-full text-gray-700 font-semibold transition-all duration-200 hover:bg-blue-500 hover:text-white ml-2">
                JSON to CSV
            </button>
            <button id="tabJsonBeautifier" class="tab-button py-2 px-4 rounded-full text-gray-700 font-semibold transition-all duration-200 hover:bg-blue-500 hover:text-white ml-2">
                JSON Lint
            </button>
            <button id="tabTextDelimiter" class="tab-button py-2 px-4 rounded-full text-gray-700 font-semibold transition-all duration-200 hover:bg-blue-500 hover:text-white ml-2">
                Text Delimiter
            </button>
            <button id="tabQrCodeGenerator" class="tab-button py-2 px-4 rounded-full text-gray-700 font-semibold transition-all duration-200 hover:bg-blue-500 hover:text-white ml-2">
                QR Code
            </button>
            <button id="tabMarkdownViewer" class="tab-button py-2 px-4 rounded-full text-gray-700 font-semibold transition-all duration-200 hover:bg-blue-500 hover:text-white ml-2">
                Markdown
            </button>
        </div>

        <!-- Message display area (global for all apps) -->
        <div id="messageBox" class="mb-4 p-3 text-sm rounded-lg hidden text-left" role="alert"></div>

        <!-- CSV to JSON Section -->
        <div id="csvToJsonSection" class="converter-section">
            <p class="text-gray-600 mb-8">Upload your CSV file to convert it into a structured JSON format.</p>
            <input
                type="file"
                id="csvFileInput"
                accept=".csv"
                class="block w-full text-sm text-gray-500
                       file:mr-4 file:py-2 file:px-4
                       file:rounded-full file:border-0
                       file:text-sm file:font-semibold
                       file:bg-blue-50 file:text-blue-700
                       hover:file:bg-blue-100 mb-6 cursor-pointer"
            />
            <button
                id="convertCsvToJsonButton"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full
                       shadow-lg transform transition-all duration-200 ease-in-out
                       hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300
                       disabled:opacity50 disabled:cursor-not-allowed mb-6"
                disabled
            >
                Convert to JSON
            </button>

            <div id="jsonOutputContainer" class="hidden mt-6 text-left">
                <label for="jsonOutput" class="block text-gray-700 text-sm font-bold mb-2">Generated JSON:</label>
                <textarea
                    id="jsonOutput"
                    class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-blue-500"
                    readonly
                ></textarea>
                <button
                    id="downloadJsonButton"
                    class="mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-5 rounded-full
                           shadow-md transform transition-all duration-200 ease-in-out
                           hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300"
                >
                    Download JSON
                </button>
            </div>
        </div>

        <!-- JSON to CSV Section -->
        <div id="jsonToCsvSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8">Upload your JSON file to convert it into a downloadable CSV spreadsheet.</p>
            <input
                type="file"
                id="jsonFileInput"
                accept=".json"
                class="block w-full text-sm text-gray-500
                       file:mr-4 file:py-2 file:px-4
                       file:rounded-full file:border-0
                       file:text-sm file:font-semibold
                       file:bg-blue-50 file:text-blue-700
                       hover:file:bg-blue-100 mb-6 cursor-pointer"
            />
            <button
                id="convertJsonToCsvButton"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full
                       shadow-lg transform transition-all duration-200 ease-in-out
                       hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300
                       disabled:opacity50 disabled:cursor-not-allowed"
                disabled
            >
                Convert to CSV
            </button>
        </div>

        <!-- JSON Beautifier Section -->
        <div id="jsonBeautifierSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8">Paste your JSON string below to lint and beautify it.</p>
            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-6">
                <button
                    id="beautifyJsonButton"
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full
                           shadow-lg transform transition-all duration-200 ease-in-out
                           hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center justify-center space-x-2"
                >
                    <i class="fas fa-code"></i> <span>Lint & Beautify</span>
                </button>
                <button
                    id="downloadBeautifiedJsonButton"
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full
                           shadow-md transform transition-all duration-200 ease-in-out
                           hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 hidden flex items-center justify-center space-x-2"
                >
                    <i class="fas fa-download"></i> <span>Download JSON</span>
                </button>
                <button
                    id="copyBeautifiedJsonButton"
                    class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full
                           shadow-md transform transition-all duration-200 ease-in-out
                           hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 hidden flex items-center justify-center space-x-2"
                >
                    <i class="fas fa-copy"></i> <span>Copy JSON</span>
                </button>
            </div>
            <div class="flex flex-col md:flex-row md:space-x-4 mb-6">
                <div class="flex-1 w-full md:w-1/2 mb-4 md:mb-0">
                    <label for="jsonInputToBeautify" class="block text-gray-700 text-sm font-bold mb-2 text-left">Input JSON String:</label>
                    <textarea
                        id="jsonInputToBeautify"
                        class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[300px]"
                        placeholder='e.g., {"name":"John Doe","age":30,"city":"New York"}'
                    ></textarea>
                </div>
                <div class="flex-1 w-full md:w-1/2">
                    <label for="beautifiedJsonOutput" class="block text-gray-700 text-sm font-bold mb-2 text-left">Beautified JSON:</label>
                    <textarea
                        id="beautifiedJsonOutput"
                        class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-blue-500"
                        readonly
                        rows="1"
                    ></textarea>
                </div>
            </div>
        </div>

        <!-- Text Delimiter Section -->
        <div id="textDelimiterSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8">Paste your text and replace one delimiter with another.</p>
            <div class="flex flex-col md:flex-row md:space-x-4 mb-6">
                <div class="flex-1 w-full md:w-1/2 mb-4 md:mb-0">
                    <label for="textInputToReplace" class="block text-gray-700 text-sm font-bold mb-2 text-left">Input Text:</label>
                    <textarea
                        id="textInputToReplace"
                        class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[300px]"
                        placeholder='e.g., apple|banana|cherry'
                    ></textarea>
                </div>
                <div class="flex-1 w-full md:w-1/2">
                    <label for="replacedTextOutput" class="block text-gray-700 text-sm font-bold mb-2 text-left">Replaced Text:</label>
                    <textarea
                        id="replacedTextOutput"
                        class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-blue-500"
                        readonly
                        rows="1"
                    ></textarea>
                </div>
            </div>
            <div class="flex flex-col md:flex-row md:space-x-4 items-end mb-6">
                <div class="w-full md:w-1/3 mb-4 md:mb-0 text-left">
                    <label for="oldDelimiterInput" class="block text-gray-700 text-sm font-bold mb-2">Old Delimiter:</label>
                    <input type="text" id="oldDelimiterInput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., |" />
                </div>
                <div class="w-full md:w-1/3 mb-4 md:mb-0 text-left">
                    <label for="newDelimiterInput" class="block text-gray-700 text-sm font-bold mb-2">New Delimiter:</label>
                    <input type="text" id="newDelimiterInput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., ," />
                </div>
                <button id="replaceDelimiterButton" class="w-full md:w-1/3 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center justify-center space-x-2">
                    <i class="fas fa-exchange-alt"></i> <span>Replace Delimiter</span>
                </button>
            </div>
            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-6 justify-end">
                <button id="downloadReplacedTextButton" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-md transform transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 hidden flex items-center justify-center space-x-2">
                    <i class="fas fa-download"></i> <span>Download Text</span>
                </button>
                <button id="copyReplacedTextButton" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full shadow-md transform transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 hidden flex items-center justify-center space-x-2">
                    <i class="fas fa-copy"></i> <span>Copy Text</span>
                </button>
            </div>
        </div>
        
        <!-- QR Code Generator Section -->
        <div id="qrCodeGeneratorSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8">Enter any text or link to instantly generate a QR code image.</p>
            <div class="flex flex-col md:flex-row md:space-x-4 mb-6 items-start">
                <div class="flex-1 w-full md:w-1/2 mb-4 md:mb-0">
                    <label for="qrCodeInput" class="block text-gray-700 text-sm font-bold mb-2 text-left">Text or Link:</label>
                    <textarea id="qrCodeInput" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[200px]" placeholder='e.g., https://www.google.com'></textarea>
                    <button id="generateQrCodeButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center justify-center space-x-2 mt-4">
                        <i class="fas fa-qrcode"></i> <span>Generate QR Code</span>
                    </button>
                </div>
                <div class="flex-1 w-full md:w-1/2">
                    <label class="block text-gray-700 text-sm font-bold mb-2 text-left">Generated QR Code:</label>
                    <div id="qrCodeOutputContainer" class="p-4 bg-gray-50 border border-gray-300 rounded-lg flex flex-col items-center justify-center min-h-[200px] space-y-4">
                        <canvas id="qrCodeCanvas" class="hidden"></canvas>
                        <p id="qrCodePlaceholder" class="text-gray-500 text-sm">QR Code will appear here.</p>
                        <button id="downloadQrCodeButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full shadow-md transform transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 hidden flex items-center justify-center space-x-2">
                            <i class="fas fa-download"></i> <span>Download QR Code</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Markdown Viewer Section -->
        <div id="markdownViewerSection" class="converter-section hidden">
            <p class="text-gray-600 mb-8">Write Markdown on the left and see the rendered HTML on the right.</p>
            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-6">
                <button id="copyMarkdownHtmlButton" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full shadow-md transform transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 flex items-center justify-center space-x-2">
                    <i class="fas fa-copy"></i> <span>Copy Rendered HTML</span>
                </button>
                <button id="downloadMarkdownHtmlButton" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-md transform transition-all duration-200 ease-in-out hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 flex items-center justify-center space-x-2">
                    <i class="fas fa-download"></i> <span>Download HTML</span>
                </button>
            </div>
            <div class="flex flex-col md:flex-row md:space-x-4 mb-6">
                <div class="flex-1 w-full md:w-1/2 mb-4 md:mb-0">
                    <label for="markdownInput" class="block text-gray-700 text-sm font-bold mb-2 text-left">Markdown Editor:</label>
                    <textarea
                        id="markdownInput"
                        class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-800 font-mono text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[400px]"
                        placeholder="# Hello Markdown&#10;&#10;Write your content here..."
                    ></textarea>
                </div>
                <div class="flex-1 w-full md:w-1/2">
                    <label class="block text-gray-700 text-sm font-bold mb-2 text-left">Live Preview:</label>
                    <div id="markdownPreview"></div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- Global DOM References ---
        const messageBox = document.getElementById('messageBox');
        const tabCsvToJson = document.getElementById('tabCsvToJson');
        const tabJsonToCsv = document.getElementById('tabJsonToCsv');
        const tabJsonBeautifier = document.getElementById('tabJsonBeautifier');
        const tabTextDelimiter = document.getElementById('tabTextDelimiter');
        const tabQrCodeGenerator = document.getElementById('tabQrCodeGenerator');
        const tabMarkdownViewer = document.getElementById('tabMarkdownViewer');

        const csvToJsonSection = document.getElementById('csvToJsonSection');
        const jsonToCsvSection = document.getElementById('jsonToCsvSection');
        const jsonBeautifierSection = document.getElementById('jsonBeautifierSection');
        const textDelimiterSection = document.getElementById('textDelimiterSection');
        const qrCodeGeneratorSection = document.getElementById('qrCodeGeneratorSection');
        const markdownViewerSection = document.getElementById('markdownViewerSection');

        const downloadBeautifiedJsonButton = document.getElementById('downloadBeautifiedJsonButton');
        const copyBeautifiedJsonButton = document.getElementById('copyBeautifiedJsonButton');
        const downloadReplacedTextButton = document.getElementById('downloadReplacedTextButton');
        const copyReplacedTextButton = document.getElementById('copyReplacedTextButton');
        const downloadQrCodeButton = document.getElementById('downloadQrCodeButton');
        const qrCodeCanvas = document.getElementById('qrCodeCanvas');
        const qrCodePlaceholder = document.getElementById('qrCodePlaceholder');
        const markdownPreview = document.getElementById('markdownPreview');

        // --- Utility Functions ---

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight + 2) + 'px';
        }

        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');
            if (type === 'success') messageBox.classList.add('bg-green-100', 'text-green-800');
            else if (type === 'error') messageBox.classList.add('bg-red-100', 'text-red-800');
            else messageBox.classList.add('bg-blue-100', 'text-blue-800');
            messageBox.classList.remove('hidden');
        }

        function hideMessageBox() {
            messageBox.classList.add('hidden');
        }

        function downloadText(textContent, filename, mimeType = 'text/plain') {
            const blob = new Blob([textContent], { type: `${mimeType};charset=utf-8;` });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } else {
                showMessage('Your browser does not support downloads.', 'info');
            }
        }

        function copyToClipboard(text, successMsg) {
            const temp = document.createElement('textarea');
            temp.value = text;
            document.body.appendChild(temp);
            temp.select();
            try {
                document.execCommand('copy');
                showMessage(successMsg, 'success');
            } catch (err) {
                showMessage('Failed to copy.', 'error');
            }
            document.body.removeChild(temp);
        }

        function switchTab(activeTabButton, activeSection) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            activeTabButton.classList.add('active');
            document.querySelectorAll('.converter-section').forEach(section => section.classList.add('hidden'));
            activeSection.classList.remove('hidden');
            hideMessageBox();

            // Resets
            document.getElementById('csvFileInput').value = '';
            document.getElementById('convertCsvToJsonButton').disabled = true;
            document.getElementById('jsonOutputContainer').classList.add('hidden');
            document.getElementById('jsonOutput').value = '';
            document.getElementById('jsonFileInput').value = '';
            document.getElementById('convertJsonToCsvButton').disabled = true;
            
            document.getElementById('jsonInputToBeautify').value = '';
            beautifiedJsonOutput.value = '';
            beautifiedJsonOutput.style.height = '150px';
            downloadBeautifiedJsonButton.classList.add('hidden');
            copyBeautifiedJsonButton.classList.add('hidden');
            
            document.getElementById('textInputToReplace').value = '';
            document.getElementById('oldDelimiterInput').value = '';
            document.getElementById('newDelimiterInput').value = '';
            document.getElementById('replacedTextOutput').value = '';
            document.getElementById('replacedTextOutput').style.height = '150px';
            downloadReplacedTextButton.classList.add('hidden');
            copyReplacedTextButton.classList.add('hidden');
            
            document.getElementById('qrCodeInput').value = '';
            qrCodeCanvas.classList.add('hidden');
            qrCodePlaceholder.classList.remove('hidden');
            downloadQrCodeButton.classList.add('hidden');
            
            document.getElementById('markdownInput').value = '';
            markdownPreview.innerHTML = '';
        }

        // --- CSV to JSON ---
        csvFileInput.addEventListener('change', () => {
            document.getElementById('convertCsvToJsonButton').disabled = csvFileInput.files.length === 0;
            hideMessageBox();
            document.getElementById('jsonOutputContainer').classList.add('hidden');
        });

        document.getElementById('convertCsvToJsonButton').addEventListener('click', () => {
            const file = csvFileInput.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const res = convertCsvToJson(e.target.result);
                    document.getElementById('jsonOutput').value = JSON.stringify(res, null, 2);
                    document.getElementById('jsonOutputContainer').classList.remove('hidden');
                    showMessage('Converted!', 'success');
                } catch (err) { showMessage(err.message, 'error'); }
            };
            reader.readAsText(file);
        });

        document.getElementById('downloadJsonButton').addEventListener('click', () => {
            downloadText(document.getElementById('jsonOutput').value, 'data.json', 'application/json');
        });

        function convertCsvToJson(csvString) {
            const lines = csvString.split(/\r?\n/).filter(line => line.trim() !== '');
            if (lines.length === 0) return [];
            const headers = parseCsvLine(lines[0]);
            const jsonArray = [];
            for (let i = 1; i < lines.length; i++) {
                const rowValues = parseCsvLine(lines[i]);
                const obj = {};
                headers.forEach((h, idx) => obj[h] = rowValues[idx] || '');
                jsonArray.push(obj);
            }
            return jsonArray;
        }

        function parseCsvLine(line) {
            const fields = [];
            let inQuote = false, cur = '';
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    if (inQuote && line[i+1] === '"') { cur += '"'; i++; }
                    else inQuote = !inQuote;
                } else if (char === ',' && !inQuote) { fields.push(cur.trim()); cur = ''; }
                else cur += char;
            }
            fields.push(cur.trim());
            return fields;
        }

        // --- JSON to CSV ---
        document.getElementById('jsonFileInput').addEventListener('change', () => {
            document.getElementById('convertJsonToCsvButton').disabled = document.getElementById('jsonFileInput').files.length === 0;
            hideMessageBox();
        });

        document.getElementById('convertJsonToCsvButton').addEventListener('click', () => {
            const file = document.getElementById('jsonFileInput').files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    const csv = convertJsonToCsv(data);
                    downloadText(csv, 'data.csv', 'text/csv');
                    showMessage('CSV Downloading...', 'success');
                } catch (err) { showMessage('Invalid JSON', 'error'); }
            };
            reader.readAsText(file);
        });

        function convertJsonToCsv(jsonData) {
            if (!jsonData.length) return '';
            const keys = Array.from(new Set(jsonData.flatMap(Object.keys)));
            const rows = [keys.join(',')];
            jsonData.forEach(item => {
                rows.push(keys.map(k => {
                    let v = item[k] === null || item[k] === undefined ? '' : item[k];
                    if (typeof v === 'object') v = JSON.stringify(v);
                    v = String(v).replace(/"/g, '""');
                    return v.includes(',') || v.includes('"') || v.includes('\n') ? `"${v}"` : v;
                }).join(','));
            });
            return rows.join('\n');
        }

        // --- JSON Lint ---
        document.getElementById('beautifyJsonButton').addEventListener('click', () => {
            const val = document.getElementById('jsonInputToBeautify').value.trim();
            hideMessageBox();
            if (!val) { showMessage('Paste JSON first', 'info'); return; }
            try {
                const parsed = JSON.parse(val);
                document.getElementById('beautifiedJsonOutput').value = JSON.stringify(parsed, null, 2);
                adjustTextareaHeight(document.getElementById('beautifiedJsonOutput'));
                downloadBeautifiedJsonButton.classList.remove('hidden');
                copyBeautifiedJsonButton.classList.remove('hidden');
                showMessage('JSON Beautified', 'success');
            } catch (err) { showMessage(err.message, 'error'); }
        });

        downloadBeautifiedJsonButton.addEventListener('click', () => downloadText(document.getElementById('beautifiedJsonOutput').value, 'pretty.json', 'application/json'));
        copyBeautifiedJsonButton.addEventListener('click', () => copyToClipboard(document.getElementById('beautifiedJsonOutput').value, 'JSON Copied!'));

        // --- Text Delimiter ---
        document.getElementById('replaceDelimiterButton').addEventListener('click', () => {
            const input = document.getElementById('textInputToReplace').value;
            const oldD = document.getElementById('oldDelimiterInput').value;
            const newD = document.getElementById('newDelimiterInput').value;
            hideMessageBox();
            if (!input) return showMessage('Paste text', 'info');
            if (!oldD) return showMessage('Enter old delimiter', 'error');
            const result = input.replaceAll(oldD, newD);
            document.getElementById('replacedTextOutput').value = result;
            adjustTextareaHeight(document.getElementById('replacedTextOutput'));
            downloadReplacedTextButton.classList.remove('hidden');
            copyReplacedTextButton.classList.remove('hidden');
            showMessage('Replaced!', 'success');
        });

        downloadReplacedTextButton.addEventListener('click', () => downloadText(document.getElementById('replacedTextOutput').value, 'replaced.txt'));
        copyReplacedTextButton.addEventListener('click', () => copyToClipboard(document.getElementById('replacedTextOutput').value, 'Text Copied!'));

        // --- QR Code ---
        let qr = new QRious({ element: qrCodeCanvas, size: 256 });
        document.getElementById('generateQrCodeButton').addEventListener('click', () => {
            const val = document.getElementById('qrCodeInput').value.trim();
            hideMessageBox();
            if (!val) return showMessage('Enter text/link', 'error');
            qr.set({ value: val, foreground: '#1F2937' });
            qrCodeCanvas.classList.remove('hidden');
            qrCodePlaceholder.classList.add('hidden');
            downloadQrCodeButton.classList.remove('hidden');
            showMessage('QR Generated', 'success');
        });

        downloadQrCodeButton.addEventListener('click', () => {
            const link = document.createElement('a');
            link.href = qrCodeCanvas.toDataURL("image/png");
            link.download = 'qrcode.png';
            link.click();
        });

        // --- Markdown Viewer ---
        document.getElementById('markdownInput').addEventListener('input', () => {
            markdownPreview.innerHTML = marked.parse(document.getElementById('markdownInput').value);
        });

        document.getElementById('copyMarkdownHtmlButton').addEventListener('click', () => {
            if (!markdownPreview.innerHTML) return showMessage('Write markdown first', 'info');
            copyToClipboard(markdownPreview.innerHTML, 'HTML Copied!');
        });

        document.getElementById('downloadMarkdownHtmlButton').addEventListener('click', () => {
            if (!markdownPreview.innerHTML) return showMessage('Write markdown first', 'info');
            const fullHtml = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Rendered Markdown</title><style>body{font-family:sans-serif;padding:2em;}</style></head><body>${markdownPreview.innerHTML}</body></html>`;
            downloadText(fullHtml, 'rendered.html', 'text/html');
        });

        // --- Tab Listeners ---
        tabCsvToJson.addEventListener('click', () => switchTab(tabCsvToJson, csvToJsonSection));
        tabJsonToCsv.addEventListener('click', () => switchTab(tabJsonToCsv, jsonToCsvSection));
        tabJsonBeautifier.addEventListener('click', () => switchTab(tabJsonBeautifier, jsonBeautifierSection));
        tabTextDelimiter.addEventListener('click', () => switchTab(tabTextDelimiter, textDelimiterSection));
        tabQrCodeGenerator.addEventListener('click', () => switchTab(tabQrCodeGenerator, qrCodeGeneratorSection));
        tabMarkdownViewer.addEventListener('click', () => switchTab(tabMarkdownViewer, markdownViewerSection));

        document.addEventListener('DOMContentLoaded', () => {
            switchTab(tabCsvToJson, csvToJsonSection);
        });
    </script>
</body>
</html>
